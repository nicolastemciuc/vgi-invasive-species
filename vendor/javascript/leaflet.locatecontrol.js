// leaflet.locatecontrol@0.84.2 downloaded from https://ga.jspm.io/npm:leaflet.locatecontrol@0.84.2/dist/L.Control.Locate.esm.js

import{Marker as t,setOptions as i,divIcon as s,Control as e,DomUtil as o,Util as n,circle as a,DomEvent as l,LayerGroup as h,extend as r}from"leaflet";const c=(t,i)=>{i.split(" ").forEach((i=>{t.classList.add(i)}))};const p=(t,i)=>{i.split(" ").forEach((i=>{t.classList.remove(i)}))};const _=t.extend({initialize(t,s){i(this,s);this._latlng=t;this.createIcon()},createIcon(){const t=this.options;const i=[["stroke",t.color],["stroke-width",t.weight],["fill",t.fillColor],["fill-opacity",t.fillOpacity],["opacity",t.opacity]].filter((([t,i])=>i!==void 0)).map((([t,i])=>`${t}="${i}"`)).join(" ");const e=this._getIconSVG(t,i);this._locationIcon=s({className:e.className,html:e.svg,iconSize:[e.w,e.h]});this.setIcon(this._locationIcon)},_getIconSVG(t,i){const s=t.radius;const e=t.weight;const o=s+e;const n=o*2;const a=`<svg xmlns="http://www.w3.org/2000/svg" width="${n}" height="${n}" version="1.1" viewBox="-${o} -${o} ${n} ${n}"><circle r="${s}" ${i} /></svg>`;return{className:"leaflet-control-locate-location",svg:a,w:n,h:n}},setStyle(t){i(this,t);this.createIcon()}});const d=_.extend({initialize(t,s,e){i(this,e);this._latlng=t;this._heading=s;this.createIcon()},setHeading(t){this._heading=t},_getIconSVG(t,i){const s=t.radius;const e=t.width+t.weight;const o=(s+t.depth+t.weight)*2;const n=`M0,0 l${t.width/2},${t.depth} l-${e},0 z`;const a=`<svg xmlns="http://www.w3.org/2000/svg" width="${e}" height="${o}" version="1.1" viewBox="-${e/2} 0 ${e} ${o}" transform="rotate(${this._heading})"><path d="${n}" ${i} /></svg>`;return{className:"leaflet-control-locate-heading",svg:a,w:e,h:o}}});const m=e.extend({options:{position:"topleft",layer:void 0,setView:"untilPanOrZoom",keepCurrentZoomLevel:false,initialZoomLevel:false,getLocationBounds(t){return t.bounds},flyTo:false,clickBehavior:{inView:"stop",outOfView:"setView",inViewNotFollowing:"inView"},returnToPrevBounds:false,cacheLocation:true,drawCircle:true,drawMarker:true,showCompass:true,markerClass:_,compassClass:d,circleStyle:{className:"leaflet-control-locate-circle",color:"#136AEC",fillColor:"#136AEC",fillOpacity:.15,weight:0},markerStyle:{className:"leaflet-control-locate-marker",color:"#fff",fillColor:"#2A93EE",fillOpacity:1,weight:3,opacity:1,radius:9},compassStyle:{fillColor:"#2A93EE",fillOpacity:1,weight:0,color:"#fff",opacity:1,radius:9,width:9,depth:6},followCircleStyle:{},followMarkerStyle:{},followCompassStyle:{},icon:"leaflet-control-locate-location-arrow",iconLoading:"leaflet-control-locate-spinner",iconElementTag:"span",textElementTag:"small",circlePadding:[0,0],metric:true,createButtonCallback(t,i){const s=o.create("a","leaflet-bar-part leaflet-bar-part-single",t);s.title=i.strings.title;s.href="#";s.setAttribute("role","button");const e=o.create(i.iconElementTag,i.icon,s);if(i.strings.text!==void 0){const t=o.create(i.textElementTag,"leaflet-locate-text",s);t.textContent=i.strings.text;s.classList.add("leaflet-locate-text-active");s.parentNode.style.display="flex";i.icon.length>0&&e.classList.add("leaflet-locate-icon")}return{link:s,icon:e}},onLocationError(t,i){alert(t.message)},onLocationOutsideMapBounds(t){t.stop();alert(t.options.strings.outsideMapBoundsMsg)},showPopup:true,strings:{title:"Show me where I am",metersUnit:"meters",feetUnit:"feet",popup:"You are within {distance} {unit} from this point",outsideMapBoundsMsg:"You seem located outside the boundaries of the map"},locateOptions:{maxZoom:Infinity,watch:true,setView:false}},initialize(t){for(const i in t)typeof this.options[i]==="object"?r(this.options[i],t[i]):this.options[i]=t[i];this.options.followMarkerStyle=r({},this.options.markerStyle,this.options.followMarkerStyle);this.options.followCircleStyle=r({},this.options.circleStyle,this.options.followCircleStyle);this.options.followCompassStyle=r({},this.options.compassStyle,this.options.followCompassStyle)},onAdd(t){const i=o.create("div","leaflet-control-locate leaflet-bar leaflet-control");this._container=i;this._map=t;this._layer=this.options.layer||new h;this._layer.addTo(t);this._event=void 0;this._compassHeading=null;this._prevBounds=null;const s=this.options.createButtonCallback(i,this.options);this._link=s.link;this._icon=s.icon;l.on(this._link,"click",(function(t){l.stopPropagation(t);l.preventDefault(t);this._onClick()}),this).on(this._link,"dblclick",l.stopPropagation);this._resetVariables();this._map.on("unload",this._unload,this);return i},_onClick(){this._justClicked=true;const t=this._isFollowing();this._userPanned=false;this._userZoomed=false;if(this._active&&!this._event)this.stop();else if(this._active){const i=this.options.clickBehavior;let s=i.outOfView;this._map.getBounds().contains(this._event.latlng)&&(s=t?i.inView:i.inViewNotFollowing);i[s]&&(s=i[s]);switch(s){case"setView":this.setView();break;case"stop":this.stop();if(this.options.returnToPrevBounds){const t=this.options.flyTo?this._map.flyToBounds:this._map.fitBounds;t.bind(this._map)(this._prevBounds)}break}}else{this.options.returnToPrevBounds&&(this._prevBounds=this._map.getBounds());this.start()}this._updateContainerStyle()},start(){this._activate();if(this._event){this._drawMarker(this._map);this.options.setView&&this.setView()}this._updateContainerStyle()},stop(){this._deactivate();this._cleanClasses();this._resetVariables();this._removeMarker()},stopFollowing(){this._userPanned=true;this._updateContainerStyle();this._drawMarker()},_activate(){if(!this._active&&this._map){this._map.locate(this.options.locateOptions);this._map.fire("locateactivate",this);this._active=true;this._map.on("locationfound",this._onLocationFound,this);this._map.on("locationerror",this._onLocationError,this);this._map.on("dragstart",this._onDrag,this);this._map.on("zoomstart",this._onZoom,this);this._map.on("zoomend",this._onZoomEnd,this);if(this.options.showCompass){const t="ondeviceorientationabsolute"in window;if(t||"ondeviceorientation"in window){const i=this;const s=function(){l.on(window,t?"deviceorientationabsolute":"deviceorientation",i._onDeviceOrientation,i)};DeviceOrientationEvent&&typeof DeviceOrientationEvent.requestPermission==="function"?DeviceOrientationEvent.requestPermission().then((function(t){t==="granted"&&s()})):s()}}}},_deactivate(){if(this._active&&this._map){this._map.stopLocate();this._map.fire("locatedeactivate",this);this._active=false;this.options.cacheLocation||(this._event=void 0);this._map.off("locationfound",this._onLocationFound,this);this._map.off("locationerror",this._onLocationError,this);this._map.off("dragstart",this._onDrag,this);this._map.off("zoomstart",this._onZoom,this);this._map.off("zoomend",this._onZoomEnd,this);if(this.options.showCompass){this._compassHeading=null;"ondeviceorientationabsolute"in window?l.off(window,"deviceorientationabsolute",this._onDeviceOrientation,this):"ondeviceorientation"in window&&l.off(window,"deviceorientation",this._onDeviceOrientation,this)}}},setView(){this._drawMarker();if(this._isOutsideMapBounds()){this._event=void 0;this.options.onLocationOutsideMapBounds(this)}else if(this._justClicked&&this.options.initialZoomLevel!==false){let t=this.options.flyTo?this._map.flyTo:this._map.setView;t.bind(this._map)([this._event.latitude,this._event.longitude],this.options.initialZoomLevel)}else if(this.options.keepCurrentZoomLevel){let t=this.options.flyTo?this._map.flyTo:this._map.panTo;t.bind(this._map)([this._event.latitude,this._event.longitude])}else{let t=this.options.flyTo?this._map.flyToBounds:this._map.fitBounds;this._ignoreEvent=true;t.bind(this._map)(this.options.getLocationBounds(this._event),{padding:this.options.circlePadding,maxZoom:this.options.initialZoomLevel||this.options.locateOptions.maxZoom});n.requestAnimFrame((function(){this._ignoreEvent=false}),this)}},_drawCompass(){if(!this._event)return;const t=this._event.latlng;if(this.options.showCompass&&t&&this._compassHeading!==null){const i=this._isFollowing()?this.options.followCompassStyle:this.options.compassStyle;if(this._compass){this._compass.setLatLng(t);this._compass.setHeading(this._compassHeading);this._compass.setStyle&&this._compass.setStyle(i)}else this._compass=new this.options.compassClass(t,this._compassHeading,i).addTo(this._layer)}if(this._compass&&(!this.options.showCompass||this._compassHeading===null)){this._compass.removeFrom(this._layer);this._compass=null}},_drawMarker(){this._event.accuracy===void 0&&(this._event.accuracy=0);const t=this._event.accuracy;const i=this._event.latlng;if(this.options.drawCircle){const s=this._isFollowing()?this.options.followCircleStyle:this.options.circleStyle;this._circle?this._circle.setLatLng(i).setRadius(t).setStyle(s):this._circle=a(i,t,s).addTo(this._layer)}let s;let e;if(this.options.metric){s=t.toFixed(0);e=this.options.strings.metersUnit}else{s=(t*3.2808399).toFixed(0);e=this.options.strings.feetUnit}if(this.options.drawMarker){const t=this._isFollowing()?this.options.followMarkerStyle:this.options.markerStyle;if(this._marker){this._marker.setLatLng(i);this._marker.setStyle&&this._marker.setStyle(t)}else this._marker=new this.options.markerClass(i,t).addTo(this._layer)}this._drawCompass();const o=this.options.strings.popup;function l(){return typeof o==="string"?n.template(o,{distance:s,unit:e}):typeof o==="function"?o({distance:s,unit:e}):o}this.options.showPopup&&o&&this._marker&&this._marker.bindPopup(l())._popup.setLatLng(i);this.options.showPopup&&o&&this._compass&&this._compass.bindPopup(l())._popup.setLatLng(i)},_removeMarker(){this._layer.clearLayers();this._marker=void 0;this._circle=void 0},_unload(){this.stop();this._map&&this._map.off("unload",this._unload,this)},_setCompassHeading(t){if(!isNaN(parseFloat(t))&&isFinite(t)){t=Math.round(t);this._compassHeading=t;n.requestAnimFrame(this._drawCompass,this)}else this._compassHeading=null},_onCompassNeedsCalibration(){this._setCompassHeading()},_onDeviceOrientation(t){this._active&&(t.webkitCompassHeading?this._setCompassHeading(t.webkitCompassHeading):t.absolute&&t.alpha&&this._setCompassHeading(360-t.alpha))},_onLocationError(t){if(t.code!=3||!this.options.locateOptions.watch){this.stop();this.options.onLocationError(t,this)}},_onLocationFound(t){if((!this._event||this._event.latlng.lat!==t.latlng.lat||this._event.latlng.lng!==t.latlng.lng||this._event.accuracy!==t.accuracy)&&this._active){this._event=t;this._drawMarker();this._updateContainerStyle();switch(this.options.setView){case"once":this._justClicked&&this.setView();break;case"untilPan":this._userPanned||this.setView();break;case"untilPanOrZoom":this._userPanned||this._userZoomed||this.setView();break;case"always":this.setView();break}this._justClicked=false}},_onDrag(){if(this._event&&!this._ignoreEvent){this._userPanned=true;this._updateContainerStyle();this._drawMarker()}},_onZoom(){if(this._event&&!this._ignoreEvent){this._userZoomed=true;this._updateContainerStyle();this._drawMarker()}},_onZoomEnd(){this._event&&this._drawCompass();if(this._event&&!this._ignoreEvent&&this._marker&&!this._map.getBounds().pad(-.3).contains(this._marker.getLatLng())){this._userPanned=true;this._updateContainerStyle();this._drawMarker()}},_isFollowing(){return!!this._active&&(this.options.setView==="always"||(this.options.setView==="untilPan"?!this._userPanned:this.options.setView==="untilPanOrZoom"?!this._userPanned&&!this._userZoomed:void 0))},_isOutsideMapBounds(){return this._event!==void 0&&(this._map.options.maxBounds&&!this._map.options.maxBounds.contains(this._event.latlng))},_updateContainerStyle(){this._container&&(this._active&&!this._event?this._setClasses("requesting"):this._isFollowing()?this._setClasses("following"):this._active?this._setClasses("active"):this._cleanClasses())},_setClasses(t){if(t=="requesting"){p(this._container,"active following");c(this._container,"requesting");p(this._icon,this.options.icon);c(this._icon,this.options.iconLoading)}else if(t=="active"){p(this._container,"requesting following");c(this._container,"active");p(this._icon,this.options.iconLoading);c(this._icon,this.options.icon)}else if(t=="following"){p(this._container,"requesting");c(this._container,"active following");p(this._icon,this.options.iconLoading);c(this._icon,this.options.icon)}},_cleanClasses(){o.removeClass(this._container,"requesting");o.removeClass(this._container,"active");o.removeClass(this._container,"following");p(this._icon,this.options.iconLoading);c(this._icon,this.options.icon)},_resetVariables(){this._active=false;this._justClicked=false;this._userPanned=false;this._userZoomed=false}});function u(t){return new m(t)}export{d as CompassMarker,m as LocateControl,_ as LocationMarker,u as locate};

